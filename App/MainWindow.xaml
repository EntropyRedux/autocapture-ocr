<Window x:Class="AutoCaptureOCR.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:AutoCaptureOCR.App"
        xmlns:vm="clr-namespace:AutoCaptureOCR.App.ViewModels"
        mc:Ignorable="d"
        Title="AutoCapture OCR v2.0"
        Height="800" Width="1400"
        WindowStartupLocation="CenterScreen"
        Background="#1E1E1E">

    <Window.InputBindings>
        <!-- Project Management -->
        <KeyBinding Key="N" Modifiers="Ctrl" Command="{Binding CreateProjectCommand}"/>
        <KeyBinding Key="N" Modifiers="Ctrl+Shift" Command="{Binding CreateSessionCommand}"/>

        <!-- Capture Operations -->
        <KeyBinding Key="R" Modifiers="Ctrl" Command="{Binding CaptureRegionCommand}"/>
        <KeyBinding Key="F" Modifiers="Ctrl+Shift" Command="{Binding CaptureFullscreenCommand}"/>
        <KeyBinding Key="F9" Command="{Binding CaptureLockedRegionCommand}"/>

        <!-- Export & Tools -->
        <KeyBinding Key="E" Modifiers="Ctrl" Command="{Binding ExportProjectCommand}"/>
        <KeyBinding Key="E" Modifiers="Ctrl+Shift" Command="{Binding ExportSessionCommand}"/>
        <KeyBinding Key="T" Modifiers="Ctrl" Command="{Binding OpenTemplateManagerCommand}"/>
        <KeyBinding Key="A" Modifiers="Ctrl+Shift" Command="{Binding ViewAnalyticsCommand}"/>

        <!-- Settings -->
        <KeyBinding Key="OemComma" Modifiers="Ctrl" Command="{Binding OpenSettingsCommand}"/>
    </Window.InputBindings>

    <Window.Resources>
        <!-- Colors -->
        <SolidColorBrush x:Key="BackgroundBrush" Color="#1E1E1E"/>
        <SolidColorBrush x:Key="SidebarBrush" Color="#252526"/>
        <SolidColorBrush x:Key="PanelBrush" Color="#2D2D30"/>
        <SolidColorBrush x:Key="AccentBrush" Color="#0E639C"/>
        <SolidColorBrush x:Key="BorderBrush" Color="#3F3F46"/>
        <SolidColorBrush x:Key="TextBrush" Color="#CCCCCC"/>
        <SolidColorBrush x:Key="TextSecondaryBrush" Color="#858585"/>
        <SolidColorBrush x:Key="SuccessBrush" Color="#4EC9B0"/>
        <SolidColorBrush x:Key="HoverBrush" Color="#2A2D2E"/>

        <!-- Button Styles -->
        <Style x:Key="ToolbarButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="3"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#1177BB"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Opacity" Value="0.5"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- ListBox Item Style -->
        <Style x:Key="SidebarItem" TargetType="ListBoxItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border Background="{TemplateBinding Background}"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource HoverBrush}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Title Bar -->
        <Border Grid.Row="0" Background="{StaticResource SidebarBrush}" Padding="16,12">
            <Grid>
                <TextBlock Text="AutoCapture OCR"
                           FontSize="18"
                           FontWeight="SemiBold"
                           Foreground="{StaticResource TextBrush}"
                           VerticalAlignment="Center"/>
                <TextBlock Text="v2.0 - Project-Based Workflow"
                           FontSize="11"
                           Foreground="{StaticResource TextSecondaryBrush}"
                           HorizontalAlignment="Right"
                           VerticalAlignment="Center"/>
            </Grid>
        </Border>

        <!-- Toolbar -->
        <Border Grid.Row="1" Background="{StaticResource PanelBrush}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1" Padding="12,10">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                <!-- Project & Session -->
                <Button ToolTip="New Project (Ctrl+N)"
                        Command="{Binding CreateProjectCommand}"
                        Style="{StaticResource ToolbarButton}"
                        Padding="10,8"
                        Margin="0,0,4,0">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="âž•" FontSize="14" Margin="0,0,6,0"/>
                        <TextBlock Text="New Project" FontSize="12" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
                <Button ToolTip="New Session (Ctrl+Shift+N)"
                        Command="{Binding CreateSessionCommand}"
                        Style="{StaticResource ToolbarButton}"
                        Padding="10,8"
                        Margin="0,0,8,0">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ“" FontSize="14" Margin="0,0,6,0"/>
                        <TextBlock Text="New Session" FontSize="12" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
                <Separator Width="1" Background="{StaticResource BorderBrush}" Margin="4,0"/>

                <!-- Capture Actions -->
                <Button Content="ðŸ“¸" ToolTip="Capture Region (Ctrl+R)"
                        Command="{Binding CaptureRegionCommand}"
                        Style="{StaticResource ToolbarButton}"
                        Padding="10,8"
                        Margin="4,0,4,0"/>
                <Button Content="ðŸ–¥ï¸" ToolTip="Capture Fullscreen (Ctrl+Shift+F)"
                        Command="{Binding CaptureFullscreenCommand}"
                        Style="{StaticResource ToolbarButton}"
                        Padding="10,8"
                        Margin="0,0,4,0"/>

                <!-- Capture Mode Toggle -->
                <Button Content="{Binding CaptureModeIcon}" ToolTip="{Binding CaptureModeText}"
                        Command="{Binding CycleCaptureModeCommand}"
                        Style="{StaticResource ToolbarButton}"
                        Padding="10,8"
                        Margin="0,0,8,0"
                        Background="#4EC9B0"/>
                <Separator Width="1" Background="{StaticResource BorderBrush}" Margin="4,0"/>

                <!-- Continuous Mode Toggle - Start Button -->
                <Button Content="ðŸ”„" ToolTip="Start Continuous Mode"
                        Command="{Binding StartContinuousModeCommand}"
                        Style="{StaticResource ToolbarButton}"
                        Padding="10,8"
                        Margin="4,0,8,0"
                        Visibility="{Binding IsInContinuousMode, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>

                <!-- Continuous Mode Toggle - Stop Button -->
                <Button Content="â¹ï¸" ToolTip="Stop Continuous Mode"
                        Command="{Binding StopContinuousModeCommand}"
                        Padding="10,8"
                        Margin="4,0,8,0"
                        Visibility="{Binding IsInContinuousMode, Converter={StaticResource BoolToVisibilityConverter}}">
                    <Button.Style>
                        <Style TargetType="Button" BasedOn="{StaticResource ToolbarButton}">
                            <Setter Property="Background" Value="#D13438"/>
                        </Style>
                    </Button.Style>
                </Button>

                <!-- Continuous Mode Controls (visible only when active) -->
                <StackPanel Orientation="Horizontal" Visibility="{Binding IsInContinuousMode, Converter={StaticResource BoolToVisibilityConverter}}">
                    <Button Content="ðŸ“¸" ToolTip="Capture Now (F9)"
                            Command="{Binding CaptureLockedRegionCommand}"
                            Style="{StaticResource ToolbarButton}"
                            Background="#4EC9B0"
                            Padding="10,8"
                            Margin="0,0,4,0"/>
                    <Button ToolTip="Toggle Auto-Capture"
                            Command="{Binding ToggleAutoCaptureCommand}"
                            Padding="10,8"
                            Margin="0,0,4,0">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource ToolbarButton}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsAutoCapturing}" Value="False">
                                        <Setter Property="Content" Value="â–¶ï¸"/>
                                        <Setter Property="Background" Value="#4EC9B0"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding IsAutoCapturing}" Value="True">
                                        <Setter Property="Content" Value="â¸ï¸"/>
                                        <Setter Property="Background" Value="#CE9178"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>

                    <!-- Interval Selector -->
                    <ComboBox SelectedItem="{Binding AutoCaptureInterval}"
                              ToolTip="Auto-Capture Interval (seconds)"
                              Width="50"
                              Height="28"
                              FontSize="12"
                              VerticalContentAlignment="Center"
                              Background="{StaticResource PanelBrush}"
                              Foreground="{StaticResource TextBrush}"
                              BorderBrush="{StaticResource BorderBrush}"
                              Margin="0,0,4,0">
                        <ComboBox.Items>
                            <System:Int32 xmlns:System="clr-namespace:System;assembly=mscorlib">5</System:Int32>
                            <System:Int32 xmlns:System="clr-namespace:System;assembly=mscorlib">10</System:Int32>
                            <System:Int32 xmlns:System="clr-namespace:System;assembly=mscorlib">15</System:Int32>
                            <System:Int32 xmlns:System="clr-namespace:System;assembly=mscorlib">30</System:Int32>
                            <System:Int32 xmlns:System="clr-namespace:System;assembly=mscorlib">60</System:Int32>
                        </ComboBox.Items>
                    </ComboBox>

                    <!-- Capture Count -->
                    <Border Background="#2D2D30"
                            BorderBrush="{StaticResource BorderBrush}"
                            BorderThickness="1"
                            CornerRadius="3"
                            Padding="6,4"
                            ToolTip="{Binding LockedRegionInfo}">
                        <TextBlock Text="{Binding CaptureCountText}"
                                   Foreground="{StaticResource SuccessBrush}"
                                   FontSize="11"
                                   FontWeight="Bold"
                                   VerticalAlignment="Center"/>
                    </Border>
                </StackPanel>
                <Separator Width="1" Background="{StaticResource BorderBrush}" Margin="4,0"/>

                <!-- Processing & Export -->
                <Button Content="âš¡" ToolTip="Process Queue"
                        Command="{Binding ProcessQueueCommand}"
                        Style="{StaticResource ToolbarButton}"
                        Padding="10,8"
                        Margin="4,0,4,0"/>
                <Button Content="ðŸ“" ToolTip="Process Selected OCR"
                        Command="{Binding ProcessSelectedOCRCommand}"
                        Style="{StaticResource ToolbarButton}"
                        Padding="10,8"
                        Margin="0,0,8,0"/>
                <Separator Width="1" Background="{StaticResource BorderBrush}" Margin="4,0"/>

                <!-- View Actions (when capture selected) -->
                <Button Content="ðŸ–¼ï¸" ToolTip="View Image"
                        Command="{Binding ViewImageCommand}"
                        Style="{StaticResource ToolbarButton}"
                        Background="#4EC9B0"
                        Padding="10,8"
                        Margin="4,0,4,0"/>
                <Button Content="ðŸ“‚" ToolTip="Open Folder"
                        Command="{Binding ViewFolderCommand}"
                        Style="{StaticResource ToolbarButton}"
                        Padding="10,8"
                        Margin="0,0,4,0"/>
                <Button Content="ðŸ—‘ï¸" ToolTip="Delete Selected"
                        Command="{Binding DeleteCapturesCommand}"
                        Style="{StaticResource ToolbarButton}"
                        Background="#D13438"
                        Padding="10,8"
                        Margin="0,0,8,0"/>
                <Separator Width="1" Background="{StaticResource BorderBrush}" Margin="4,0"/>
                <Button Content="ðŸ“Š" ToolTip="Analytics (Ctrl+Shift+A)"
                        Command="{Binding ViewAnalyticsCommand}"
                        Style="{StaticResource ToolbarButton}"
                        Padding="10,8"
                        Margin="4,0,4,0"/>
                <Button Content="ðŸ’¾" ToolTip="Export Project (Ctrl+E)"
                        Command="{Binding ExportProjectCommand}"
                        Style="{StaticResource ToolbarButton}"
                        Padding="10,8"
                        Margin="0,0,8,0"/>
                <Separator Width="1" Background="{StaticResource BorderBrush}" Margin="4,0"/>
                <Button Content="ðŸ“‹" ToolTip="Template Manager (Ctrl+T)"
                        Command="{Binding OpenTemplateManagerCommand}"
                        Style="{StaticResource ToolbarButton}"
                        Padding="10,8"
                        Margin="4,0,4,0"/>
                <Button Content="âš™ï¸" ToolTip="Settings (Ctrl+,)"
                        Command="{Binding OpenSettingsCommand}"
                        Style="{StaticResource ToolbarButton}"
                        Padding="10,8"
                        Margin="0,0,0,0"/>
            </StackPanel>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="0.2*" MinWidth="250" MaxWidth="400"/>
                <ColumnDefinition Width="0.8*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Sidebar: Projects & Sessions -->
            <Border Grid.Column="0" Background="{StaticResource SidebarBrush}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,1,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Projects Header -->
                    <Border Grid.Row="0" Background="{StaticResource PanelBrush}" Padding="12,10">
                        <TextBlock Text="PROJECTS"
                                   FontSize="11"
                                   FontWeight="Bold"
                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                    </Border>

                    <!-- Projects List -->
                    <ListBox Grid.Row="1"
                             x:Name="ProjectsListBox"
                             ItemsSource="{Binding Projects}"
                             SelectedItem="{Binding SelectedProject}"
                             Background="Transparent"
                             BorderThickness="0"
                             ItemContainerStyle="{StaticResource SidebarItem}"
                             Tag="{Binding DataContext, RelativeSource={RelativeSource AncestorType=Window}}">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Tag="{Binding DataContext, RelativeSource={RelativeSource AncestorType=ListBox}}">
                                    <StackPanel.ContextMenu>
                                        <ContextMenu>
                                            <MenuItem Header="âœï¸ Rename" Command="{Binding PlacementTarget.Tag.EditProjectCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"/>
                                            <MenuItem Header="ðŸ—‘ï¸ Delete" Command="{Binding PlacementTarget.Tag.DeleteProjectCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"/>
                                        </ContextMenu>
                                    </StackPanel.ContextMenu>
                                    <TextBlock Text="{Binding Name}"
                                               FontSize="13"
                                               FontWeight="Medium"
                                               Foreground="{StaticResource TextBrush}"/>
                                    <TextBlock Text="{Binding Sessions.Count, StringFormat={}{0} sessions}"
                                               FontSize="11"
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               Margin="0,2,0,0"/>
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>

                    <!-- Sessions Header -->
                    <Border Grid.Row="2" Background="{StaticResource PanelBrush}" Padding="12,10" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1,0,0">
                        <TextBlock Text="SESSIONS"
                                   FontSize="11"
                                   FontWeight="Bold"
                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                    </Border>

                    <!-- Sessions List -->
                    <ListBox Grid.Row="3"
                             x:Name="SessionsListBox"
                             ItemsSource="{Binding SelectedProject.Sessions}"
                             SelectedItem="{Binding SelectedSession}"
                             Background="Transparent"
                             BorderThickness="0"
                             ItemContainerStyle="{StaticResource SidebarItem}"
                             Tag="{Binding DataContext, RelativeSource={RelativeSource AncestorType=Window}}">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Tag="{Binding DataContext, RelativeSource={RelativeSource AncestorType=ListBox}}">
                                    <StackPanel.ContextMenu>
                                        <ContextMenu>
                                            <MenuItem Header="âœï¸ Rename" Command="{Binding PlacementTarget.Tag.EditSessionCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"/>
                                            <MenuItem Header="ðŸ—‘ï¸ Delete" Command="{Binding PlacementTarget.Tag.DeleteSessionCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"/>
                                        </ContextMenu>
                                    </StackPanel.ContextMenu>
                                    <TextBlock Text="{Binding Name}"
                                               FontSize="13"
                                               Foreground="{StaticResource TextBrush}"/>
                                    <TextBlock Text="{Binding Captures.Count, StringFormat={}{0} captures}"
                                               FontSize="11"
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               Margin="0,2,0,0"/>
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
            </Border>

            <!-- Resizable Splitter -->
            <GridSplitter Grid.Column="0"
                          Width="4"
                          HorizontalAlignment="Right"
                          Background="{StaticResource BorderBrush}"
                          Cursor="SizeWE"/>

            <!-- Right Side: Thumbnail Gallery + OCR Panel -->
            <Grid Grid.Column="1" Background="{StaticResource BackgroundBrush}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="0.6*" MinHeight="200"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="0.4*" MinHeight="150"/>
                </Grid.RowDefinitions>

                <!-- Gallery Header -->
                <Border Grid.Row="0" Background="{StaticResource PanelBrush}" Padding="16,12" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
                    <Grid>
                        <TextBlock Text="{Binding SelectedSession.Name, StringFormat=Session: {0}, FallbackValue=No Session Selected}"
                                   FontSize="14"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource TextBrush}"
                                   VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding SelectedSession.Captures.Count, StringFormat={}{0} captures, FallbackValue=--}"
                                   FontSize="12"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   HorizontalAlignment="Right"
                                   VerticalAlignment="Center"/>
                    </Grid>
                </Border>

                <!-- Horizontal Filmstrip with Multi-Select (Max 2 rows) -->
                <ScrollViewer Grid.Row="1"
                              HorizontalScrollBarVisibility="Auto"
                              VerticalScrollBarVisibility="Disabled"
                              Padding="16">
                    <ListBox x:Name="CapturesListBox"
                             ItemsSource="{Binding SelectedSession.Captures}"
                             SelectionMode="Extended"
                             SelectionChanged="CapturesListBox_SelectionChanged"
                             Background="Transparent"
                             BorderThickness="0"
                             MaxHeight="280">
                        <ListBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel Orientation="Horizontal" MaxHeight="280"/>
                            </ItemsPanelTemplate>
                        </ListBox.ItemsPanel>
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{StaticResource PanelBrush}"
                                        BorderBrush="{StaticResource BorderBrush}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Width="130"
                                        Height="130"
                                        Margin="0,0,12,12"
                                        Cursor="Hand"
                                        MouseLeftButtonDown="Thumbnail_Click">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="*"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <!-- Thumbnail Image -->
                                        <Border Grid.Row="0" Background="#3F3F46" Margin="4">
                                            <Image Source="{Binding FilePath, Converter={StaticResource ImagePathConverter}}"
                                                   Stretch="Uniform"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"/>
                                        </Border>

                                        <!-- Compact Info -->
                                        <StackPanel Grid.Row="1" Margin="4,0,4,4">
                                            <TextBlock Text="{Binding SequenceNumber, StringFormat=#{0}}"
                                                       FontSize="10"
                                                       FontWeight="Bold"
                                                       Foreground="{StaticResource TextBrush}"
                                                       TextAlignment="Center"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="BorderThickness" Value="2"/>
                                <Setter Property="BorderBrush" Value="Transparent"/>
                                <Setter Property="Padding" Value="0"/>
                                <Setter Property="Margin" Value="4"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="ListBoxItem">
                                            <Border Background="{TemplateBinding Background}"
                                                    BorderBrush="{TemplateBinding BorderBrush}"
                                                    BorderThickness="{TemplateBinding BorderThickness}"
                                                    CornerRadius="4"
                                                    Padding="{TemplateBinding Padding}">
                                                <ContentPresenter/>
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="BorderBrush" Value="#4EC9B0"/>
                                        <Setter Property="Background" Value="#1A4EC9B0"/>
                                    </Trigger>
                                    <MultiTrigger>
                                        <MultiTrigger.Conditions>
                                            <Condition Property="IsMouseOver" Value="True"/>
                                            <Condition Property="IsSelected" Value="False"/>
                                        </MultiTrigger.Conditions>
                                        <Setter Property="Background" Value="#1A3E3E42"/>
                                    </MultiTrigger>
                                </Style.Triggers>
                            </Style>
                        </ListBox.ItemContainerStyle>
                    </ListBox>
                </ScrollViewer>

                <!-- Empty State -->
                <StackPanel Grid.Row="1"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Visibility="{Binding HasNoCaptures, Converter={StaticResource BoolToVisibilityConverter}}">
                    <TextBlock Text="ðŸ“¸"
                               FontSize="72"
                               HorizontalAlignment="Center"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               Opacity="0.3"/>
                    <TextBlock Text="No captures yet"
                               FontSize="16"
                               HorizontalAlignment="Center"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               Margin="0,16,0,4"/>
                    <TextBlock Text="Click capture buttons in the toolbar to get started"
                               FontSize="12"
                               HorizontalAlignment="Center"
                               Foreground="{StaticResource TextSecondaryBrush}"/>
                </StackPanel>

                <!-- Splitter -->
                <GridSplitter Grid.Row="2"
                              Height="4"
                              HorizontalAlignment="Stretch"
                              Background="{StaticResource BorderBrush}"
                              Cursor="SizeNS"/>

                <!-- OCR Results Panel -->
                <Border Grid.Row="3"
                        Background="{StaticResource PanelBrush}"
                        BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="0,1,0,0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- OCR Header (Compact) -->
                        <Border Grid.Row="0" Padding="12,8" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Left: Badge + Display Dropdown -->
                                <StackPanel Grid.Column="0" Orientation="Horizontal">
                                    <!-- OCR Results Badge -->
                                    <Border Background="{StaticResource SidebarBrush}"
                                            BorderBrush="{StaticResource BorderBrush}"
                                            BorderThickness="1"
                                            CornerRadius="3"
                                            Padding="6,3"
                                            Margin="0,0,8,0">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="ðŸ“"
                                                       FontSize="12"
                                                       VerticalAlignment="Center"
                                                       Margin="0,0,4,0"/>
                                            <TextBlock Text="OCR Results"
                                                       FontSize="11"
                                                       FontWeight="SemiBold"
                                                       Foreground="{StaticResource TextBrush}"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>

                                    <!-- Display Dropdown -->
                                    <ComboBox ItemsSource="{Binding DisplayModes}"
                                              SelectedItem="{Binding CurrentDisplayMode}"
                                              Width="110"
                                              Height="24"
                                              FontSize="11"
                                              Background="#2D2D30"
                                              Foreground="White"
                                              BorderBrush="#3F3F46"
                                              BorderThickness="1">
                                        <ComboBox.Style>
                                            <Style TargetType="ComboBox">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="ComboBox">
                                                            <Grid>
                                                                <ToggleButton x:Name="ToggleButton"
                                                                            Grid.Column="2"
                                                                            Focusable="false"
                                                                            IsChecked="{Binding Path=IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                                                            ClickMode="Press"
                                                                            Background="{TemplateBinding Background}"
                                                                            BorderBrush="{TemplateBinding BorderBrush}"
                                                                            BorderThickness="{TemplateBinding BorderThickness}">
                                                                    <ToggleButton.Style>
                                                                        <Style TargetType="ToggleButton">
                                                                            <Setter Property="Template">
                                                                                <Setter.Value>
                                                                                    <ControlTemplate TargetType="ToggleButton">
                                                                                        <Border Background="{TemplateBinding Background}"
                                                                                               BorderBrush="{TemplateBinding BorderBrush}"
                                                                                               BorderThickness="{TemplateBinding BorderThickness}"
                                                                                               CornerRadius="3">
                                                                                            <Grid>
                                                                                                <Grid.ColumnDefinitions>
                                                                                                    <ColumnDefinition/>
                                                                                                    <ColumnDefinition Width="18"/>
                                                                                                </Grid.ColumnDefinitions>
                                                                                                <ContentPresenter Grid.Column="0"
                                                                                                                Margin="6,0,0,0"
                                                                                                                HorizontalAlignment="Left"
                                                                                                                VerticalAlignment="Center"
                                                                                                                Content="{TemplateBinding Content}"/>
                                                                                                <Path Grid.Column="1"
                                                                                                     HorizontalAlignment="Center"
                                                                                                     VerticalAlignment="Center"
                                                                                                     Data="M 0 0 L 4 4 L 8 0 Z"
                                                                                                     Fill="White"/>
                                                                                            </Grid>
                                                                                        </Border>
                                                                                        <ControlTemplate.Triggers>
                                                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                                                <Setter Property="Background" Value="#3F3F46"/>
                                                                                            </Trigger>
                                                                                        </ControlTemplate.Triggers>
                                                                                    </ControlTemplate>
                                                                                </Setter.Value>
                                                                            </Setter>
                                                                        </Style>
                                                                    </ToggleButton.Style>
                                                                </ToggleButton>
                                                                <ContentPresenter x:Name="ContentSite"
                                                                                IsHitTestVisible="False"
                                                                                Content="{TemplateBinding SelectionBoxItem}"
                                                                                ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                                                                ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                                                                Margin="6,0,18,0"
                                                                                VerticalAlignment="Center"
                                                                                HorizontalAlignment="Left"/>
                                                                <Popup x:Name="Popup"
                                                                      Placement="Bottom"
                                                                      IsOpen="{TemplateBinding IsDropDownOpen}"
                                                                      AllowsTransparency="True"
                                                                      Focusable="False"
                                                                      PopupAnimation="Slide">
                                                                    <Grid x:Name="DropDown"
                                                                         SnapsToDevicePixels="True"
                                                                         MinWidth="{TemplateBinding ActualWidth}"
                                                                         MaxHeight="150">
                                                                        <Border x:Name="DropDownBorder"
                                                                               Background="#2D2D30"
                                                                               BorderBrush="#007ACC"
                                                                               BorderThickness="1"
                                                                               CornerRadius="3"/>
                                                                        <ScrollViewer Margin="4,6,4,6"
                                                                                    SnapsToDevicePixels="True">
                                                                            <StackPanel IsItemsHost="True"
                                                                                      KeyboardNavigation.DirectionalNavigation="Contained"/>
                                                                        </ScrollViewer>
                                                                    </Grid>
                                                                </Popup>
                                                            </Grid>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </ComboBox.Style>
                                        <ComboBox.ItemContainerStyle>
                                            <Style TargetType="ComboBoxItem">
                                                <Setter Property="Foreground" Value="White"/>
                                                <Setter Property="Background" Value="Transparent"/>
                                                <Setter Property="Padding" Value="8,4"/>
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="ComboBoxItem">
                                                            <Border Background="{TemplateBinding Background}"
                                                                   BorderThickness="0"
                                                                   Padding="{TemplateBinding Padding}">
                                                                <ContentPresenter/>
                                                            </Border>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="#007ACC"/>
                                                    </Trigger>
                                                    <Trigger Property="IsSelected" Value="True">
                                                        <Setter Property="Background" Value="#094771"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ComboBox.ItemContainerStyle>
                                    </ComboBox>
                                </StackPanel>

                                <!-- Right: Action Buttons (Right-aligned, compact) -->
                                <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right">
                                    <!-- Edit Metadata Toggle Button (only when single item selected) -->
                                    <Button ToolTip="Edit Metadata"
                                            Command="{Binding EditMetadataCommand}"
                                            Padding="8,4"
                                            FontSize="12"
                                            Width="28"
                                            Height="24">
                                        <Button.Style>
                                            <Style TargetType="Button" BasedOn="{StaticResource ToolbarButton}">
                                                <Setter Property="Content" Value="âœï¸"/>
                                                <Setter Property="Background" Value="Transparent"/>
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding SelectedCaptures.Count}" Value="1">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding IsMetadataEditorOpen}" Value="True">
                                                        <Setter Property="Content" Value="âœ•"/>
                                                        <Setter Property="Background" Value="#CE9178"/>
                                                        <Setter Property="ToolTip" Value="Close Editor"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- OCR Text Content + Metadata Editor (Split View) -->
                        <Grid Grid.Row="1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <!-- GridSplitter Column -->
                                <ColumnDefinition>
                                    <ColumnDefinition.Style>
                                        <Style TargetType="ColumnDefinition">
                                            <Setter Property="Width" Value="0"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsMetadataEditorOpen}" Value="True">
                                                    <Setter Property="Width" Value="4"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </ColumnDefinition.Style>
                                </ColumnDefinition>
                                <!-- Metadata Editor Column - only visible when open -->
                                <ColumnDefinition x:Name="MetadataEditorColumn" Width="0"/>
                            </Grid.ColumnDefinitions>

                            <!-- Left: OCR Results -->
                            <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Auto" Padding="16">
                                <TextBox Text="{Binding CombinedOCRText, Mode=OneWay}"
                                         TextWrapping="Wrap"
                                         IsReadOnly="True"
                                         FontFamily="Consolas"
                                         FontSize="12"
                                         Foreground="{StaticResource TextBrush}"
                                         Background="Transparent"
                                         BorderThickness="0"
                                         VerticalScrollBarVisibility="Disabled"/>
                            </ScrollViewer>

                            <!-- GridSplitter (Resizer) -->
                            <GridSplitter Grid.Column="1"
                                          Width="4"
                                          HorizontalAlignment="Stretch"
                                          Background="{StaticResource BorderBrush}"
                                          Cursor="SizeWE"
                                          Visibility="{Binding IsMetadataEditorOpen, Converter={StaticResource BoolToVisibilityConverter}}"/>

                            <!-- Right: Inline Metadata Editor -->
                            <Border Grid.Column="2"
                                    Background="{StaticResource SidebarBrush}"
                                    BorderBrush="{StaticResource BorderBrush}"
                                    BorderThickness="1,0,0,0"
                                    Visibility="{Binding IsMetadataEditorOpen, Converter={StaticResource BoolToVisibilityConverter}}">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>

                                    <!-- Metadata Editor Header -->
                                    <Border Grid.Row="0" Background="{StaticResource PanelBrush}" Padding="12,10" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
                                        <Grid>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="âœï¸"
                                                           FontSize="14"
                                                           VerticalAlignment="Center"
                                                           Margin="0,0,8,0"/>
                                                <TextBlock Text="Metadata Editor"
                                                           FontSize="13"
                                                           FontWeight="SemiBold"
                                                           Foreground="{StaticResource TextBrush}"
                                                           VerticalAlignment="Center"/>
                                            </StackPanel>
                                            <Button Content="âœ•"
                                                    Command="{Binding EditMetadataCommand}"
                                                    ToolTip="Close Editor"
                                                    HorizontalAlignment="Right"
                                                    Width="24"
                                                    Height="24"
                                                    FontSize="12"
                                                    Padding="0"
                                                    Background="Transparent"
                                                    BorderThickness="0"
                                                    Foreground="{StaticResource TextSecondaryBrush}"/>
                                        </Grid>
                                    </Border>

                                    <!-- Metadata Editor Content -->
                                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="12">
                                        <StackPanel>
                                            <!-- Capture Info -->
                                            <TextBlock Text="{Binding SelectedCaptures[0].FileName, StringFormat=File: {0}}"
                                                       FontSize="11"
                                                       Foreground="{StaticResource TextSecondaryBrush}"
                                                       Margin="0,0,0,4"/>
                                            <TextBlock Text="{Binding SelectedCaptures[0].Timestamp, StringFormat='Captured: {0:yyyy-MM-dd HH:mm:ss}'}"
                                                       FontSize="11"
                                                       Foreground="{StaticResource TextSecondaryBrush}"
                                                       Margin="0,0,0,16"/>

                                            <!-- Quick Tag Section -->
                                            <TextBlock Text="Quick Tag"
                                                       FontSize="12"
                                                       FontWeight="SemiBold"
                                                       Foreground="{StaticResource TextBrush}"
                                                       Margin="0,0,0,8"/>

                                            <Grid Margin="0,0,0,12">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0"
                                                           Text="Element:"
                                                           FontSize="11"
                                                           Foreground="{StaticResource TextBrush}"
                                                           VerticalAlignment="Center"
                                                           Margin="0,0,8,0"/>

                                                <ComboBox Grid.Column="1"
                                                          x:Name="ElementTypeComboBox"
                                                          FontSize="11"
                                                          Padding="6,4"
                                                          Background="{StaticResource BackgroundBrush}"
                                                          Foreground="{StaticResource TextBrush}"
                                                          BorderBrush="{StaticResource BorderBrush}"
                                                          Margin="0,0,4,0"
                                                          ToolTip="Select element type to quickly tag">
                                                    <ComboBoxItem Content="Button"/>
                                                    <ComboBoxItem Content="Input"/>
                                                    <ComboBoxItem Content="Label"/>
                                                    <ComboBoxItem Content="Link"/>
                                                    <ComboBoxItem Content="Image"/>
                                                    <ComboBoxItem Content="Container"/>
                                                    <ComboBoxItem Content="Menu"/>
                                                    <ComboBoxItem Content="Dialog"/>
                                                    <ComboBoxItem Content="Checkbox"/>
                                                    <ComboBoxItem Content="Radio"/>
                                                    <ComboBoxItem Content="Dropdown"/>
                                                    <ComboBoxItem Content="Text"/>
                                                    <ComboBoxItem Content="Heading"/>
                                                    <ComboBoxItem Content="Icon"/>
                                                </ComboBox>

                                                <Button Grid.Column="2"
                                                        Content="Tag"
                                                        Click="QuickTag_Click"
                                                        FontSize="11"
                                                        Padding="12,4"
                                                        Background="#4EC9B0"
                                                        Foreground="White"
                                                        BorderBrush="{StaticResource BorderBrush}"
                                                        ToolTip="Add element type tag to metadata"/>
                                            </Grid>

                                            <!-- Custom Metadata Fields -->
                                            <TextBlock Text="Custom Metadata"
                                                       FontSize="12"
                                                       FontWeight="SemiBold"
                                                       Foreground="{StaticResource TextBrush}"
                                                       Margin="0,0,0,8"/>

                                            <!-- Metadata Dictionary Display/Edit -->
                                            <ItemsControl ItemsSource="{Binding CurrentMetadataFields}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Grid Margin="0,0,0,8">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="2*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                            </Grid.ColumnDefinitions>

                                                            <TextBlock Grid.Column="0"
                                                                       Text="{Binding Key}"
                                                                       FontSize="11"
                                                                       FontWeight="SemiBold"
                                                                       Foreground="{StaticResource TextBrush}"
                                                                       VerticalAlignment="Center"
                                                                       Margin="0,0,8,0"/>
                                                            <TextBox Grid.Column="1"
                                                                     Text="{Binding Value, UpdateSourceTrigger=LostFocus}"
                                                                     LostFocus="MetadataValue_LostFocus"
                                                                     Tag="{Binding Key}"
                                                                     FontSize="11"
                                                                     Padding="6,4"
                                                                     Background="{StaticResource BackgroundBrush}"
                                                                     Foreground="{StaticResource TextBrush}"
                                                                     BorderBrush="{StaticResource BorderBrush}"
                                                                     Margin="0,0,4,0"/>
                                                            <Button Grid.Column="2"
                                                                    Content="âœ•"
                                                                    ToolTip="Remove field"
                                                                    Command="{Binding DataContext.RemoveMetadataFieldCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                    CommandParameter="{Binding Key}"
                                                                    Width="24"
                                                                    Height="24"
                                                                    FontSize="11"
                                                                    Padding="0"
                                                                    Background="#D13438"
                                                                    Foreground="White"
                                                                    BorderThickness="1"
                                                                    BorderBrush="{StaticResource BorderBrush}"/>
                                                        </Grid>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>

                                            <!-- Add New Field Section (Compact) -->
                                            <Border Background="{StaticResource PanelBrush}"
                                                    BorderBrush="{StaticResource BorderBrush}"
                                                    BorderThickness="1"
                                                    CornerRadius="2"
                                                    Padding="6"
                                                    Margin="0,8,0,0">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>

                                                    <!-- Field Name Input -->
                                                    <TextBox Grid.Column="0"
                                                             Text="{Binding NewMetadataKey, UpdateSourceTrigger=PropertyChanged}"
                                                             FontSize="10"
                                                             Padding="4,3"
                                                             Background="{StaticResource BackgroundBrush}"
                                                             Foreground="{StaticResource TextBrush}"
                                                             BorderBrush="{StaticResource BorderBrush}"
                                                             Margin="0,0,3,0"
                                                             ToolTip="Field Name"/>

                                                    <!-- Field Value Input -->
                                                    <TextBox Grid.Column="1"
                                                             Text="{Binding NewMetadataValue, UpdateSourceTrigger=PropertyChanged}"
                                                             FontSize="10"
                                                             Padding="4,3"
                                                             Background="{StaticResource BackgroundBrush}"
                                                             Foreground="{StaticResource TextBrush}"
                                                             BorderBrush="{StaticResource BorderBrush}"
                                                             Margin="0,0,3,0"
                                                             ToolTip="Field Value"/>

                                                    <!-- Add Button (Icon) -->
                                                    <Button Grid.Column="2"
                                                            Content="+"
                                                            ToolTip="Add Field"
                                                            Command="{Binding AddMetadataFieldCommand}"
                                                            FontSize="12"
                                                            FontWeight="Bold"
                                                            Padding="8,0"
                                                            Width="28"
                                                            Height="24"
                                                            Background="#4EC9B0"
                                                            Foreground="White"
                                                            BorderBrush="{StaticResource BorderBrush}"/>
                                                </Grid>
                                            </Border>
                                        </StackPanel>
                                    </ScrollViewer>
                                </Grid>
                            </Border>
                        </Grid>
                    </Grid>
                </Border>
            </Grid>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="3" Background="{StaticResource SidebarBrush}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1,0,0" Padding="12,8">
            <Grid>
                <TextBlock Text="{Binding StatusText}"
                           FontSize="12"
                           Foreground="{StaticResource TextSecondaryBrush}"
                           VerticalAlignment="Center"/>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <TextBlock Text="{Binding QueueCount, StringFormat=Queue: {0}}"
                               FontSize="11"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               Margin="0,0,16,0"
                               VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding SelectedProject.Name, StringFormat=Project: {0}, FallbackValue=No project}"
                               FontSize="11"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
